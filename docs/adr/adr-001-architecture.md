## ADR-001: Вибір архітектурного підходу для сервісу підписки на погоду

#### Статус: Прийнято

#### Дата: 2025-06-08

#### Автор: Зіновий Богдан

---

### Контекст

Необхідно було побудувати сервіс для надсилання прогнозу погоди користувачам на email із підтримкою:

- підтвердження/скасування підписки через токени
- вибору періодичності (щогодинно / щоденно)
- інтеграція зі стороннім апі для отримання даних про погоду

Додаткові умови:

- легка інтеграція з поштовим сервісом та стороннім сервісом Weather API
- можливість реалізувати розширювану бізнес-логіку та легко масштабуватися

---

### Розглянуті варіанти архітектури:

#### 1. MVC / Service-based

- Плюси: швидка побудова застосунку, проста інтеграція
- Мінуси: домішування логіки між контролерами/сервісами/БД, слабка модульність, важче масштабуватися

#### 2. Hexagonal / Clean Architecture:

- Плюси:
  - чітке розділення шарів
  - робота з доменними моделями, що не залежать від інфраструктури
  - підтримка DDD-підходу
  - краща модульність і тестованість
- Мінуси: більша складність реалізації на старті проекту

---

### Прийняте рішення:

**Clean Architecture**

---

### Схема проєкту:

```text
src
├── common                 # спільні константи, enums, інтерфейси
├── config                 # глобальні конфігурації API, SMTP, DB
├── database               # підключення до бази даних та міграції
├── mail                   # логіка відправки листів
├── subscription
│   ├── application        # сron-задачі, SubscriptionService
│   ├── domain             # модель Subscription, інтерфейс репозиторію
│   ├── infrastructure     # ORM-ентіті, TypeORM-репозиторій, контролер
├── token
│   ├── application        # TokenService
│   ├── domain             # модель Token, інтерфейс репозиторію
│   ├── infrastructure     # ORM-ентіті, TypeORM-репозиторій
├── weather
│   ├── application        # WeatherService
│   ├── domain             # модель Weather
│   ├── infrastructure     # контролер
```

---

### Наслідки

#### Позитивні:

- логіка підписки, підтвердження, розсилки розділена по відповідних шарах
- репозиторії ізолюються за інтерфейсами, тому можна легко змінити реалізацію на іншу технологію
- чітке використання доменних моделей у шарі відповідальному за бізнес-логіку
- спрощується тестування, бо можна мокати репозиторії та сервіси
- застосунок простіше масштабується і його можна розбити на мікросервіси

#### Негативні:

- зайва складність як для малого MVP проєкту
- на початковому етапі проєкту потрібно більше часу на розробку
